<!-- <link rel="stylesheet" href="<%= assetPath('css/user_profile.css') %>"> -->
<style>
    p{padding:0;margin:0}a,a:hover{color:#aed5ff}.container{width:75%;height:auto;margin-bottom:5%}.user-details{display:flex;justify-content:space-between;text-align:right;padding:1.5% 3%}#user-image{height:100px;width:100px;border-radius:50%}#follow-button-div button{border-radius:10px;font-size:.8rem;padding:3% 6%;background-color:#6ea8b3;font-weight:600;cursor:pointer}#follow-button-div button:hover{transform:scale(1.1);transition:.1s ease-in}#user-name{font-size:1.5rem;font-family:sans-serif;font-weight:700}.user-name-hello{display:flex;flex-direction:column;justify-content:space-around}.followers,.following{text-align:center;padding:1.5% 1%;cursor:pointer}#contest-details{display:none}#contest-details #winning-amount{padding:3%;margin:2% 4%;text-align:center;background-color:#e2e2e2;border-radius:10px}#contest-details #winning-amount p{font-size:1.2rem;font-weight:700}#contest-details #general-stats{padding:3%;margin:2% 4%;background-color:#e2e2e2;display:flex;justify-content:space-between;margin-bottom:2%;text-align:center;border-radius:10px}#contest-details #general-stats .general-stats-value{font-weight:700;font-size:1.2rem}i{margin-left:-1%;color:gray;font-size:22px}.logo-name{display:flex;flex-direction:row;padding:1.5% 3%}.logo-name p{margin-left:2%;margin-top:-.2%;font-weight:600}.profile-sections,.profile-sections-main{background-color:hsla(0,0%,100%,.9);color:#000;margin:2%;padding-bottom:1%;border-radius:10px;box-shadow:8px 8px 12px 2px rgba(0,0,0,.4)}.profile-sections:hover{cursor:pointer;transform:scale(1.008)}#referAndEarn,#transaction-details-container,#wallet-details{padding:3%;margin:2% 4%;align-items:center;text-align:center;display:flex;flex-direction:column;display:none;background-color:#e2e2e2;border-radius:20px;transition:visibility .5s,opacity .5s linear}.transaction-details{padding:2%;margin:2%;border:1px solid #000;border-radius:10px;background-color:#fff;display:flex;justify-content:space-between}.amount{width:10%}.action{color:green;text-align:left;width:25%}.transactioId{width:40%}.date{width:25%}#wallet-logo{color:green}#add-account-button,#add-money-button,#withdraw-money-button{padding:.7%;font-weight:500;width:20%;border-radius:10px;border:1px solid #000;background-color:#888;cursor:pointer;margin-left:2%;margin-right:2%;font-size:1.2rem;margin-top:2%}#add-money-button:hover{background-color:#038d03;transition:.2s ease-in}#withdraw-money-button:hover{background-color:#b80505;transition:.2s ease-in}#enter-add-amount-div,#enter-withdraw-amount-div{display:none;background-color:#e2e2e2;border-radius:20px;padding:3%;margin:2% 4%}#enter-add-amount-div p,#enter-withdraw-amount-div p{margin-left:18%;font-size:1.2rem;margin-bottom:1%}#enter-add-amount-div #add-cash-button,#enter-add-amount-div #withdraw-cash-button,#enter-withdraw-amount-div #add-cash-button,#enter-withdraw-amount-div #withdraw-cash-button{width:15%;padding:.6%;border-radius:10px;background-color:#8b8b8b;margin-left:42.5%;margin-top:3%;font-weight:600}#rupee-amount-input{display:flex}#rupee-icon{width:15%;background-color:#bedd9f;text-align:center;margin-left:17.5%;padding:1% 0;border:1px solid green;font-size:1.5rem;border-right:0;border-radius:10px 0 0 10px}#enter-add-amount-input,#enter-withdraw-amount-input{width:50%;border:1px solid green;border-left:0;padding-left:2%;outline:none;font-size:1.2rem;font-weight:400;border-radius:0 10px 10px 0}#my-balance-title{font-size:1.5rem}#wallet-balance{font-size:2rem;font-weight:700}fieldset{border:1px dashed #000;border-radius:10px;padding:2%;width:50%;margin:auto}legend{font-size:.8rem;width:auto;text-align:left}#refer-code{width:auto;overflow-wrap:break-word}.get-upto{font-size:1.2rem;font-weight:700}.refer-earn-price{font-size:2rem;color:green;font-weight:800}.referral-msg{font-size:1.1rem;font-weight:600}#enter-account-div{background-color:#e2e2e2;border-radius:20px;padding:3%;margin:2% 4%;display:none}#enter-account-div p{margin-left:30%;font-size:1.1rem}#ifsc-account-div input{width:40%;margin-left:30%;border:1px solid green;padding:1%;margin-top:1%;outline:none;font-size:1.2rem;font-weight:400;border-radius:10px}#add-account-button{width:20%;margin-left:40%;font-size:1.1rem}#followers-list,#following-list{display:none;position:absolute;background-image:url(https://media.istockphoto.com/photos/grass-field-ground-top-view-picture-id1192236248?h=QcNPrNc_LLaUI5H1mmGpsIyT0mX-OHFTZk_redKHcUs=&k=20&m=1192236248&s=612x612&w=0);width:26%;height:50%;top:25%;left:37%;border-radius:10px;overflow:scroll}#followers-list #followers-list-heading,#followers-list #following-list-heading,#following-list #followers-list-heading,#following-list #following-list-heading{color:#fff;text-align:center;font-size:1.2rem;margin-top:1%;border-bottom:.5px solid gray;padding-bottom:2%}#followers-list #close-followers-list,#followers-list #close-following-list,#following-list #close-followers-list,#following-list #close-following-list{position:absolute;color:#fff;top:2%;right:1.5%;cursor:pointer}#followers-list #followers-userNames,#followers-list #following-userNames,#following-list #followers-userNames,#following-list #following-userNames{color:#fff;padding:1.5% 5%;font-size:1.1rem}#followers-list #follower-image,#followers-list #following-image,#following-list #follower-image,#following-list #following-image{height:30px;width:33px;border-radius:50%;margin-right:3%}#followers-list::-webkit-scrollbar,#following-list::-webkit-scrollbar{display:none}
</style>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<div class="container">
    <div class="user-details profile-sections-main">
        <div>
            <img src="https://images.fanfight.com/avatars/avatar20.png" alt="User Avatar" id="user-image">
        </div>

        <div class="followers">
            <p>
                <%= followers.length %>
            </p>
            <p>
                followers
            </p>
        </div>

        <div class="following">
            <p>
                <%= following.length %>
            </p>
            <p>
                following
            </p>
        </div>

        <div class="user-name-hello">
            <p>Hello,</p>
            <p id="user-name"><%= userId %></p>
            <% if(user.userId != userId){ %>
                <div id="follow-button-div">
                    <% if(!isUserPresent){ %>
                        <button id="follow-button" data-follow-userId = "<%= userId%>">
                            FOLLOW
                        </button>
                    <% }else{ %>
                        <button id="following-div">
                            Following
                        </button>
                    <% } %>
                </div>
            <% } %>
        </div>
    </div>

    <% if(user.userId == userId){ %>
        <div class="user-wallet profile-sections">
            <div id="wallet-icon-name" class="logo-name">
                <i class="fas fa-wallet"></i>
                <p>
                    My Balance
                </p>
            </div>
            <div id="wallet-details">
                <p ><i class="fas fa-wallet fa-5x" id="wallet-logo"></i></p>
                <p id="my-balance-title">MY BALANCE</p>
                <p id="wallet-balance" data-wallet-balance = "<%= wallet %>">₹ <%= wallet %></p>
                <button id="add-money-button">
                    Add Cash
                </button>
                <button id="withdraw-money-button">
                    Withdraw Cash
                </button>
            </div>
    
            <div id="enter-add-amount-div">
                <p>
                    Enter Amount
                </p>
                <div id="rupee-amount-input">
                    <div id="rupee-icon">
                        ₹
                    </div>
                    <input type="tel" name="amount" maxlength="8" placeholder="Enter amount (₹20 to ₹100000)" id="enter-add-amount-input" value="" required>
                </div>
                <button id="add-cash-button">
                    ADD CASH
                </button>
            </div>
    
            <div id="enter-withdraw-amount-div">
                <p>
                    Enter Amount
                </p>
                <div id="rupee-amount-input">
                    <div id="rupee-icon">
                        ₹
                    </div>
                    <input type="tel" name="amount" maxlength="8" placeholder="Enter amount (₹100 to ₹100000)" id="enter-withdraw-amount-input" value="" required>
                </div>
                <button id="withdraw-cash-button">
                    WITHDRAW CASH
                </button>
            </div>
        </div>
    <% } %>
    <div class="my-stats profile-sections">
        <div id="stat-icon-name" class="logo-name">
            <i class="fas fa-chart-bar" ></i>
            <% if(user.userId == userId){ %>
                <p>
                    My Stats
                </p>
            <% }else{ %>
                <p>
                    Stats
                </p>
            <% } %>
        </div>
        <div id="contest-details">
            <% if(user.userId == userId){ %>
                <div id="winning-amount">
                    <p>Total Winnings</p>
                    <p>₹ <%= totalAmountWon %> </p>
                </div>
            <% } %>
            <div id="general-stats">
                <div>
                    <p>Contest Joined </p>
                    <p class="general-stats-value">
                        <%= numberOfContestJoined %>
                    </p>
                </div>

                <div>
                    <p>Team Created</p>
                    <p class="general-stats-value">
                        <%= numberOfTeamsCreated  %>
                    </p>
                </div>
                
                <div>
                    <p>Total Wins</p>
                    <p class="general-stats-value">
                        <%= numberOfContestWon %>
                    </p>
                </div>
            </div>
        </div>

    </div>

    <% if(user.userId == userId){ %>
        <div class="my-transaction profile-sections">
            <div class="logo-name" id="transaction-div">
                <i class="fas fa-money-bill"></i>
                <p>
                    My Transactions
                </p>
            </div>

            <% function checkLength(num) {%>
                <% if(num.toString().length == 1){ %>
                    <% console.log("0"+num.toString());%>
                    <% return "0"+num.toString(); %>
                <% } %>
                <% console.log(num.toString());%>
                <% return num.toString(); %>
            <% } %>

            <div id="transaction-details-container">
                <% if(transactions.length == 0) {%>
                    <div class="transaction-details" style="align-items: center;">No Transactions Yet!</div>
                <% } %>
                <% for(let i = 0; i < transactions.length; i++){ %>
                    <% let date = new Date(transactions[i].createdAt); %>
                    <div class="transaction-details">
                        <div class="amount">
                            ₹<%= transactions[i].amount %>
                        </div>
                        <div class="action">
                            <%= transactions[i].action.toUpperCase() %>
                        </div>
                        <div class="transactioId">
                            <%= transactions[i].transactionId %>
                        </div>
                        <div class="date">
                            <%= checkLength(date.getDate()) %>/<%= checkLength(date.getMonth()+1).trim() %>/<%= date.getFullYear() %> 
                            <%= checkLength(date.getHours()) %>:<%= checkLength(date.getMinutes()) %>:<%= checkLength(date.getSeconds()) %>
                        </div>
                    </div>
                <% } %>
            </div>
        </div>

    
        <div class="refer-earn profile-sections">
            <div class="logo-name" id="refer-div">
                <i class="fas fa-gift"></i>
                <p>Refer & Earn</p>
            </div>
            <div id="referAndEarn">
                <p class="get-upto">GET UPTO</p>
                <p class="refer-earn-price">₹ 100</p>
                <p class="referral-msg">on every referral</p>
                <fieldset>
                    <legend>Your Code</legend>
                    <% let referCode = Buffer.from(userIdDB).toString('base64'); %>
                    <p id="refer-code">  <%= referCode  %> </p>
                    <i class="far fa-copy" id="refer-code-copy" data-refer-code="<%= referCode %>"></i></p>
                </fieldset>
            </div>
        </div>
    
        <div class="bank-accounts profile-sections">
            <div class="logo-name" id="bank-account-div">
                <i class="fas fa-university"></i>
                <p>Bank Account</p>
            </div>
    
            <% if(!accountNumber) {%>
                <div id="enter-account-div">
                    <p>
                        Enter Account Details
                    </p>
                    <form action="/users/profile/addAccount" method="POST">
                        <div id="ifsc-account-div">
                            <input type="text" name="ifsc" placeholder="Enter IFSC" id="enter-ifsc-code" value="" required>
                            <br>
                            <input type="text" name="accountNumber" placeholder="Enter Account Number" id="enter-account-number" value="" required>
                        </div>
                        <button id="add-account-button" type="submit">
                            ADD ACCOUNT
                        </button>
                    </form>
                </div>
            <% }else{ %>
                <div id="enter-account-div">
                    <p>
                        Account Details
                    </p>
                    <div id="ifsc-account-div">
                        <input type="text" name="ifsc" placeholder="Enter IFSC" id="enter-ifsc-code" value="<%= ifsc %>" readonly>
                        <br>
                        <input type="text" name="accountNumber" placeholder="Enter Account Number" id="enter-account-number" value="<%= accountNumber %>" readonly>
                    </div>
                </div>
            <% } %>
        </div>
    <% } %>

</div>

<div id="following-list" data-following-length = "<%= following.length %>">
    <div id="following-list-heading">
        Following
    </div>
    <i class="fa fa-window-close" id="close-following-list" style="font-size:24px;color:white"></i>
    <br>
    <% for(i of following){ %>
        <div id="following-userNames">
            <img src="https://images.fanfight.com/avatars/avatar20.png" alt="" id="following-image">
            <a href="/users/profile/<%= i %>">
                <%= i %>
            </a>
        </div>
    <% } %>
</div>

<div id="followers-list" data-followers-length = "<%= followers.length %>">
    <div id="followers-list-heading">
        Followers
    </div>
    <i class="fa fa-window-close" id="close-followers-list" style="font-size:24px;color:white"></i>
    <br>
    <% for(i of followers){ %>
        <div id="followers-userNames">
            <img src="https://images.fanfight.com/avatars/avatar20.png" alt="" id="follower-image">
            <a href="/users/profile/<%= i %>">
                <%= i %>
            </a>
        </div>
    <% } %>
</div>



<script src="<%= assetPath('js/user_profile.js') %>"></script>
